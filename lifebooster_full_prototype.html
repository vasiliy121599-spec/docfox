<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Life Booster ‚Äî Full Prototype</title>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='0.9em' font-size='90'%3Eü¶ä%3C/text%3E%3C/svg%3E">
<style>
:root{
  --accent:#6fd3ff;
  --accent-2:#9be7ff;
  --bg-day-start: rgba(230,246,255,0.9);
  --bg-night-start: rgba(2,6,20,0.95);
  --card-radius:14px;
  --glass: rgba(255,255,255,0.06);
  --glass-2: rgba(0,0,0,0.35);
  --max-width:1100px;
  --text: #e9f3f7;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:var(--text);-webkit-font-smoothing:antialiased;background:#041226}
a{color:var(--accent)}
.container{max-width:var(--max-width);margin:0 auto;padding:18px;position:relative;z-index:3}
.header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
.logo{display:flex;align-items:center;gap:12px}
.logo img{width:56px;height:56px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.5)}
.title{font-size:20px;font-weight:800;color:var(--accent)}
.controls{display:flex;gap:8px;align-items:center}
.btn{background:var(--accent);color:#022;padding:10px 14px;border-radius:12px;border:none;font-weight:800;cursor:pointer;box-shadow:0 10px 30px rgba(0,0,0,0.45)}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 12px;border-radius:10px;color:inherit;cursor:pointer}

.grid{display:grid;grid-template-columns:1fr 380px;gap:14px;align-items:start}
@media(max-width:980px){.grid{grid-template-columns:1fr} .rightCol{order:2} .leftCol{order:1}}

.card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.25));padding:14px;border-radius:var(--card-radius);backdrop-filter: blur(10px);box-shadow: 0 8px 30px rgba(2,6,23,0.6);}
.sectionTitle{font-size:16px;margin:0 0 8px 0;color:var(--accent-2)}

/* Tasks */
#taskForm{display:flex;gap:8px;margin-bottom:12px}
#taskForm input{flex:1;padding:12px;border-radius:12px;border:none;background:rgba(255,255,255,0.02);color:inherit}
.taskItem{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px;border-radius:12px;margin-bottom:8px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));}
.taskMeta{font-size:12px;color:#a9c7d6}

/* Food cards */
.foodGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media(max-width:880px){.foodGrid{grid-template-columns:repeat(2,1fr)}}
.foodCard{padding:12px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.18));min-height:110px;display:flex;flex-direction:column;justify-content:space-between;transition:transform .32s, box-shadow .32s}
.foodCard:hover{transform:translateY(-6px);box-shadow:0 14px 40px rgba(0,0,0,0.45)}
.foodTitle{font-weight:800}
.foodSub{font-size:13px;color:#cfe9f8}

/* Apps Blocker */
.appsList{display:flex;gap:8px;flex-wrap:wrap}
.appBtn{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.03);font-weight:700}

/* Exercise canvas */
#videoCanvas{display:flex;flex-direction:column;align-items:center;gap:8px;margin-top:8px}
canvas{width:100%;max-width:340px;border-radius:10px;background:rgba(0,0,0,0.12);box-shadow:inset 0 -20px 60px rgba(0,0,0,0.4)}

/* right column small */
.small{font-size:13px;color:#bcdbe8}

/* fox help */
#fox{position:fixed;right:16px;bottom:16px;width:64px;height:64px;border-radius:14px;background:linear-gradient(180deg,#ffcc88,#ffb86c);display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;box-shadow:0 16px 40px rgba(0,0,0,0.5);z-index:5}

/* footer */
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px;opacity:0.95}

/* background elements: layered animated day/night */
.bgRoot{position:fixed;inset:0;z-index:0;overflow:hidden;pointer-events:none}
.dayLayer{position:absolute;inset:0;background:linear-gradient(180deg, rgba(240,253,255,0.85), rgba(220,245,255,0.7));transition:opacity 1s ease;opacity:0}
.slideshow{position:absolute;inset:0;display:flex;gap:0;overflow:hidden}
.slide{position:absolute;inset:0;background-size:cover;background-position:center;opacity:0;transform:scale(1.02);transition:opacity 1s ease, transform 10s linear}
.slide.show{opacity:1;transform:scale(1)}
.dayOverlay{position:absolute;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04))}

/* night */
.nightLayer{position:absolute;inset:0;background:linear-gradient(180deg,#021025,#001018);opacity:0}
.starry{position:absolute;inset:0}
.earthWrap{position:absolute;right:8%;bottom:-10%;width:40vmin;height:40vmin;border-radius:50%;overflow:visible;pointer-events:none;opacity:0}

/* small responsive tweaks */
@media(max-width:520px){
  .container{padding:12px}
  .logo img{width:44px;height:44px}
  .grid{grid-template-columns:1fr}
  .foodGrid{grid-template-columns:1fr}
  canvas{max-width:100%}
  #fox{width:52px;height:52px;font-size:22px;right:10px;bottom:10px}
}

/* icons */
.iconBtn{display:inline-flex;align-items:center;gap:8px;padding:8px;border-radius:10px;background:rgba(255,255,255,0.03);cursor:pointer;border:1px solid rgba(255,255,255,0.04)}
.iconSVG{width:18px;height:18px;display:inline-block;vertical-align:middle}

/* subtle floating animation */
@keyframes floaty { 0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}
.floaty{animation:floaty 4s ease-in-out infinite}

/* star twinkle */
@keyframes twinkle{0%{opacity:0.6}50%{opacity:1}100%{opacity:0.6}} .star{opacity:0.8;animation:twinkle 3s ease-in-out infinite alternate}

/* earth rotate */
@keyframes rotateSlow{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}

/* tooltip */
.tooltip{position:relative}
.tooltip:hover::after{content:attr(data-tip);position:absolute;bottom:120%;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);padding:6px 8px;border-radius:6px;font-size:12px;color:#fff}
</style>
</head>
<body>
<!-- Background layers -->
<div class="bgRoot" id="bgRoot" aria-hidden="true">
  <div class="dayLayer" id="dayLayer">
    <div class="slideshow" id="slideshow"></div>
    <div class="dayOverlay"></div>
  </div>
  <div class="nightLayer" id="nightLayer">
    <canvas id="starCanvas" class="starry"></canvas>
    <div class="earthWrap" id="earthWrap"></div>
  </div>
</div>

<div class="container" id="appContainer">
  <div class="header">
    <div class="logo">
      <img src="https://i.imgur.com/4AiXzf8.png" alt="fox">
      <div>
        <div class="title">Life Booster</div>
        <div class="small">–©–æ–¥–µ–Ω–Ω—ñ –∑–∞–≤–¥–∞–Ω–Ω—è ‚Ä¢ –ë–ª–æ–∫—É–≤–∞–ª—å–Ω–∏–∫ ‚Ä¢ –ú–æ—Ç–∏–≤–∞—Ü—ñ—è</div>
      </div>
    </div>
    <div class="controls">
      <div class="ghost tooltip" data-tip="–ü—Ä–æ—Ñ—ñ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞"><span id="userBadge">–ì—ñ—Å—Ç—å</span></div>
      <button class="ghost tooltip" id="openIntro" data-tip="–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è">–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è</button>
      <button class="ghost" id="toggleTheme">–ù—ñ—á–Ω–∏–π —Ä–µ–∂–∏–º</button>
      <button class="btn" id="openLogin">–£–≤—ñ–π—Ç–∏</button>
    </div>
  </div>

  <div class="grid">
    <div class="leftCol">
      <div class="card">
        <h3 class="sectionTitle">–°—å–æ–≥–æ–¥–Ω—ñ—à–Ω—ñ —Å—Ç—Ä–∞–≤–∏ ‚Äî 3 —ñ–¥–µ—ó</h3>
        <div id="foodGrid" class="foodGrid"></div>
        <div style="margin-top:8px" class="small">–ü–æ—Ä–∞–¥–∞: –Ω–∞—Ç–∏—Å–Ω–∏ –Ω–∞ –∫–∞—Ä—Ç–∫—É, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ —Ä–µ—Ü–µ–ø—Ç –∞–±–æ –∑–±–µ—Ä–µ–≥—Ç–∏.</div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3 class="sectionTitle">–ó–∞–≤–¥–∞–Ω–Ω—è</h3>
        <div id="taskForm">
          <input id="taskInput" placeholder="–î–æ–¥–∞—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è (24 –≥–æ–¥.)" />
          <button class="btn" id="addTask">–î–æ–¥–∞—Ç–∏</button>
        </div>
        <div id="tasksList"></div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3 class="sectionTitle">–ë–ª–æ–∫–∞—Ç–æ—Ä –¥–æ–¥–∞—Ç–∫—ñ–≤</h3>
        <div class="small">–í–∏–±–µ—Ä–∏ –¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ —Ö–æ—á–µ—à —Ç–∏–º—á–∞—Å–æ–≤–æ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏. –†–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è ‚Äî –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤–ø—Ä–∞–≤.</div>
        <div style="margin-top:10px" class="appsList" id="appsList">
          <!-- sample app chips -->
          <div class="appBtn" data-app="instagram">Instagram</div>
          <div class="appBtn" data-app="tiktok">TikTok</div>
          <div class="appBtn" data-app="discord">Discord</div>
          <div class="appBtn" data-app="youtube">YouTube</div>
        </div>

        <div style="margin-top:12px">
          <div class="small">–ú–µ—Ç–æ–¥ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è</div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <div class="iconBtn" id="choosePush"><svg class="iconSVG" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 2v4" stroke="#022" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6h8" stroke="#022" stroke-width="1.5" stroke-linecap="round"/></svg>–í—ñ–¥–∂–∏–º–∞–Ω–Ω—è</div>
            <div class="iconBtn" id="chooseSquat"><svg class="iconSVG" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="6" r="2" stroke="#022" stroke-width="1.3"/></svg>–ü—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è</div>
            <div class="iconBtn" id="chooseWalk"><svg class="iconSVG" viewBox="0 0 24 24" fill="none"><path d="M5 20v-3l3-2 2 2 3-4 2 1" stroke="#022" stroke-width="1.5"/></svg>–•–æ–¥—å–±–∞</div>
          </div>
        </div>

        <div id="videoCanvas">
          <canvas id="exerciseCanvas" width="340" height="240"></canvas>
          <div class="small">–†–µ–ø–∏: <span id="repCount">0</span> ‚Ä¢ –õ–∏—Å–∏–Ω—è—Ç–∞: <span id="foxCoins">0</span> ü¶ä</div>
        </div>
      </div>
    </div>

    <div class="rightCol">
      <div class="card">
        <h3 class="sectionTitle">–ü–∞–Ω–µ–ª—å</h3>
        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div>
            <div class="small">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á</div>
            <div id="profileName" style="font-weight:800">–ì—ñ—Å—Ç—å</div>
          </div>
          <div style="text-align:right">
            <div class="small">–õ–∏—Å–∏–Ω—è—Ç–∞</div>
            <div id="profileCoins" style="font-weight:800">0 ü¶ä</div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="small">–ú—ñ–π –ø–ª–µ–π–ª–∏—Å—Ç</div>
        <input id="playlistInput" placeholder="–ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç" style="width:100%;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02);margin-top:8px" />
        <button class="btn" id="savePlaylist">–ó–±–µ—Ä–µ–≥—Ç–∏</button>

        <div style="height:12px"></div>
        <div class="small">–¶–∏—Ç–∞—Ç–∞ –Ω–∞—Ç—Ö–Ω–µ–Ω–Ω—è</div>
        <div id="quoteBox" style="margin-top:8px;font-weight:700;color:var(--accent)"></div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3 class="sectionTitle">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</h3>
        <input id="newUserName" placeholder="–Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞" style="width:100%;padding:10px;border-radius:10px;border:none;background:rgba(255,255,255,0.02)" />
        <button class="btn" id="addUserBtn">–î–æ–¥–∞—Ç–∏</button>
        <div id="usersList" style="margin-top:8px"></div>
      </div>

      <div style="height:12px"></div>

      <div class="card">
        <h3 class="sectionTitle">–Ü—Å—Ç–æ—Ä—ñ—è / —à—Ç—Ä–∞—Ñ–∏</h3>
        <div class="small">–Ø–∫—â–æ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ –∑–∞–≤–¥–∞–Ω–Ω—è –≤ 24 –≥–æ–¥–∏–Ω ‚Äî —à—Ç—Ä–∞—Ñ 5 ü¶ä —Ç–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å +1.5%.</div>
        <div style="height:8px"></div>
        <button class="btn" id="payFineBtn">–ö—É–ø–∏—Ç–∏ —à—Ç—Ä–∞—Ñ (5 ü¶ä)</button>
      </div>
    </div>
  </div>

  <div class="footer">
    <div class="small">–ü–æ–≤–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è. –©–æ–± –∑—Ä–æ–±–∏—Ç–∏ –ø—É–±–ª—ñ—á–Ω–æ—é ‚Äî –ø–æ—Ç—Ä—ñ–±–µ–Ω –±–µ–∫–µ–Ω–¥ (Firebase/Node/etc.).</div>
    <div class="small">–í–µ—Ä—Å—ñ—è: 1.0</div>
  </div>
</div>

<div id="fox" title="–î–æ–ø–æ–º–æ–≥–∞ (–≤—ñ–¥–∫—Ä–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É)"><span>ü¶ä</span></div>

<!-- Intro modal -->
<div id="introModal" style="position:fixed;inset:0;background:rgba(2,6,20,0.7);display:flex;align-items:center;justify-content:center;z-index:10">
  <div style="width:94%;max-width:720px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(0,0,0,0.5));padding:18px;border-radius:14px;">
    <h2 style="margin-top:0;color:var(--accent)">–õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Life Booster</h2>
    <p class="small">–ö–æ—Ä–æ—Ç–∫–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è –∑–∞–ø—É—Å–∫—É —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è ‚Äî –≤—Å–µ –ø—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ —É –±—Ä–∞—É–∑–µ—Ä—ñ.</p>
    <ol class="small">
      <li>–í—ñ–¥–∫—Ä–∏–π —Ü–µ–π —Ñ–∞–π–ª —á–µ—Ä–µ–∑ Live Server —É VS Code –∞–±–æ –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º—É https-—Å–µ—Ä–≤–µ—Ä—ñ.</li>
      <li>–ù–∞—Ç–∏—Å–Ω–∏ <b>–£–≤—ñ–π—Ç–∏</b> —ñ –≤—Å—Ç–∞–Ω–æ–≤–∏ —Å–≤–æ—î —ñ–º'—è (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ).</li>
      <li>–î–æ–¥–∞–π –∑–∞–≤–¥–∞–Ω–Ω—è ‚Äî –∫–æ–∂–Ω–µ –º–∞—î 24 –≥–æ–¥–∏–Ω–∏. –Ø–∫—â–æ –Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–æ ‚Äî —à—Ç—Ä–∞—Ñ —Ç–∞ –∑–±—ñ–ª—å—à–µ–Ω–Ω—è —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ.</li>
      <li>–©–æ–± –±–ª–æ–∫—É–≤–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–∏ ‚Äî –≤–∏–±–µ—Ä–∏ –¥–æ–¥–∞—Ç–∫–∏ —Ç–∞ –º–µ—Ç–æ–¥ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—è (–≤—ñ–¥–∂–∏–º–∞–Ω–Ω—è/–ø—Ä–∏—Å—ñ–¥–∞–Ω–Ω—è/—Ö–æ–¥—å–±–∞).</li>
      <li>–ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É –∫–∞–º–µ—Ä–∏ –¥–∞–π –¥–æ–∑–≤—ñ–ª; –¥–ª—è —Ö–æ–¥—å–±–∏ –º–æ–∂–µ –ø–æ–ø—Ä–æ—Å–∏—Ç–∏ –¥–æ–∑–≤—ñ–ª –Ω–∞ –¥–∞—Ç—á–∏–∫–∏ —Ä—É—Ö—É.</li>
      <li>–í—Å–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ localStorage; –¥–ª—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ–¥–∞–π –±–µ–∫–µ–Ω–¥ (Firebase, Supabase —á–∏ Node + DB).</li>
    </ol>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button class="ghost" id="closeIntro">–ó–∞–∫—Ä–∏—Ç–∏</button>
      <button class="btn" id="startNow">–ü–æ—á–∞—Ç–∏</button>
    </div>
  </div>
</div>

<!-- scripts: TensorFlow for pose detection -->
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@0.0.7/dist/pose-detection.min.js"></script>

<script>
/* Full enhanced prototype script */

/* ---------- Data ---------- */
const FOODS = [
  "–°–∞–ª–∞—Ç –∑ –∫—ñ–Ω–æ–∞ —Ç–∞ –∞–≤–æ–∫–∞–¥–æ","–û–º–ª–µ—Ç –∑ –æ–≤–æ—á–∞–º–∏","–°–º—É–∑—ñ –∑—ñ —à–ø–∏–Ω–∞—Ç–æ–º","–ö—É—Ä–∫–∞ –Ω–∞ –ø–∞—Ä—É –∑ –±—Ä–æ–∫–æ–ª—ñ","–¢—É—à–∫–æ–≤–∞–Ω—ñ –æ–≤–æ—á—ñ –∑ –∫—ñ–Ω–æ–∞",
  "–õ–æ—Å–æ—Å—å –∑ –æ–≤–æ—á–∞–º–∏","–°–∞–ª–∞—Ç –∑ –Ω—É—Ç–æ–º","–°—É–ø-–ø—é—Ä–µ —ñ–∑ –≥–∞—Ä–±—É–∑–∞","–ì—Ä–µ—á–∫–∞ –∑ –æ–≤–æ—á–∞–º–∏","–ß—ñ–∞-–ø—É–¥–∏–Ω–≥ –∑ —è–≥–æ–¥–∞–º–∏",
  "–°–∞–ª–∞—Ç –Ω—ñ–∫–æ–∞–∑","–ó–∞–ø–µ—á–µ–Ω—ñ –æ–≤–æ—á—ñ –∑ —Ç–æ—Ñ—É","–ü–∞—Å—Ç–∞ –∑ —Ü—ñ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ—ó –ø—à–µ–Ω–∏—Ü—ñ","–ö—É—Ä—è—á–∏–π —Å—É–ø –ª–æ–∫—à–∏–Ω–∞","–†–∏–±–∞ –Ω–∞ –≥—Ä–∏–ª—ñ –∑—ñ —Å–ø–∞—Ä–∂–µ—é",
  "–ë–æ—É–ª –∑ –±—É–ª–≥—É—Ä–æ–º —ñ –æ–≤–æ—á–∞–º–∏","–°–∞–ª–∞—Ç –∑ —Ç—É–Ω—Ü–µ–º","–†–∞–≥—É –∑ —ñ–Ω–¥–∏—á–∫–æ—é","–û–≤–æ—á–µ–≤–∏–π —Å–∞–ª–∞—Ç —ñ–∑ —è–±–ª—É–∫–æ–º","–°–∞–ª–∞—Ç —ñ–∑ –±—É—Ä—è–∫–æ–º —ñ –∫–æ–∑—è—á–∏–º —Å–∏—Ä–æ–º",
  "–¢–æ—Ñ—É —Å—Ç—ñ—Ä-—Ñ—Ä–∞–π –∑ –æ–≤–æ—á–∞–º–∏","–°–∞–ª–∞—Ç –∑ —Ä—É–∫–æ–ª–∏ —Ç–∞ –≥—Ä—É—à—ñ","–§—Ä—ñ—Ç—Ç–∞—Ç–∞ –∑ –æ–≤–æ—á–∞–º–∏","–ö–µ–±–∞–± –∑ –æ–≤–æ—á—ñ–≤","–õ–µ–≥–∫–∞ –ª–∞–∑–∞–Ω—å—è –∑—ñ —à–ø–∏–Ω–∞—Ç–æ–º",
  "–ö–∞—à–∞ –∑ –º–∏–≥–¥–∞–ª–µ–º —ñ —è–≥–æ–¥–∞–º–∏","–°–ø–∞–≥–µ—Ç—ñ –∑ –æ–≤–æ—á–µ–≤–∏–º —Å–æ—É—Å–æ–º","–ö—É—Ä—è—á—ñ –≥—Ä—É–¥–∫–∏ –∑ –∫–∏–Ω–æ–∞","–†—É–ª–µ—Ç–∏ –∑ –±–∞–∫–ª–∞–∂–∞–Ω—ñ–≤","–†–∏—Å –∑ –æ–≤–æ—á–∞–º–∏ —Ç–∞ —è–π—Ü–µ–º",
  "–¢–æ–º-—è–º –ª–µ–≥–∫–∏–π –∑ –∫—Ä–µ–≤–µ—Ç–∫–∞–º–∏","–†–∞—Ç–∞—Ç—É–π","–°–∞–ª–∞—Ç —ñ–∑ —Å–æ—á–µ–≤–∏—Ü–µ—é","–ü–µ—á–µ–Ω–∞ —Ñ–æ—Ä–µ–ª—å –∑ –ª–∏–º–æ–Ω–æ–º","–°—É–ø –∑ –±—Ä–æ–∫–æ–ª—ñ —Ç–∞ –º–∏–≥–¥–∞–ª—é",
  "–ö–µ–±–∞–± –∑ –ª–æ—Å–æ—Å–µ–º","–¢–æ—Å—Ç –∑ –∞–≤–æ–∫–∞–¥–æ —Ç–∞ —è–π—Ü–µ–º","–ë—É–ª–≥—É—Ä —Å–∞–ª–∞—Ç","–ü–µ—á–µ–Ω—ñ –∫–∞–±–∞—á–∫–∏ –∑ –ø–∞—Ä–º–µ–∑–∞–Ω–æ–º","–í–µ–≥–µ—Ç–∞—Ä—ñ–∞–Ω—Å—å–∫–∏–π –±—É—Ä–≥–µ—Ä –∑ –∫–≤–∞—Å–æ–ª–µ—é",
  "–ú–µ–∫—Å–∏–∫–∞–Ω—Å—å–∫–∏–π –±–æ—É–ª –∑ –∞–≤–æ–∫–∞–¥–æ","–°–∞–ª–∞—Ç –∑ –ø–µ—á–µ–Ω–∏–º–∏ –ø–µ—Ä—Ü—è–º–∏","–ö—É—Ä–∫–∞ –≤ –º–µ–¥–æ–≤–æ-–≥—ñ—Ä—á–∏—á–Ω–æ–º—É —Å–æ—É—Å—ñ","–¢–µ–ø–ª–∏–π —Å–∞–ª–∞—Ç –∑ —Å–æ—á–µ–≤–∏—Ü–µ—é","–°–∏—Ä–Ω–∏–∫–∏ –∑ –º–∞–ª–∏–º —Ü—É–∫—Ä–æ–º",
  "–°—É–ø —ñ–∑ —Å–æ—á–µ–≤–∏—Ü—ñ","–†—É–ª–µ—Ç–∏–∫–∏ –∑ —ñ–Ω–¥–∏—á–∫–∏","–ë–∞–∫–ª–∞–∂–∞–Ω–∏ –∑ —Ç–æ–º–∞—Ç–Ω–∏–º —Å–æ—É—Å–æ–º","–°—Ç–µ–π–∫ —Ç—É–Ω—Ü—è –∑ –æ–≤–æ—á–∞–º–∏","–ö–∞—à–∞ –≥—Ä–µ—á–∞–Ω–∞ –∑ –≥—Ä–∏–±–∞–º–∏",
  "–°–∞–ª–∞—Ç –∑ —Ñ–µ–Ω—Ö–µ–ª—é","–ü—ñ—Ü–∞ –Ω–∞ —Ü—ñ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–æ–º—É —Ç—ñ—Å—Ç—ñ –∑ –æ–≤–æ—á–∞–º–∏","–°—É—à—ñ –±–æ—É–ª –∑ –æ–≤–æ—á–∞–º–∏","–°–∞–ª–∞—Ç –∑ –∫–≤–∞—Å–æ–ª–µ—é —Ç–∞ –∫—É–∫—É—Ä—É–¥–∑–æ—é","–ó–∞–ø–µ—á–µ–Ω–∞ –∫—É—Ä–∫–∞ –∑ –ª–∏–º–æ–Ω–æ–º",
  "–§–∞—Ä—à–∏—Ä–æ–≤–∞–Ω—ñ –ø–µ—Ä—Ü—ñ –∑ –∫—ñ–Ω–æ–∞","–ö—É—Ä—è—á—ñ —à–∞—à–ª–∏—á–∫–∏ –∑ –æ–≤–æ—á–∞–º–∏","–°—É–ø-–ø—é—Ä–µ –∑ –º–æ—Ä–∫–≤–∏","–•–æ–ª–æ–¥–Ω–∏–π —Å–∞–ª–∞—Ç –∑ –æ–≥—ñ—Ä–∫—ñ–≤ —ñ –º‚Äô—è—Ç–∏","–°–∞–ª–∞—Ç –∑ —è–±–ª—É–∫–æ–º —ñ –≥–æ—Ä—ñ—Ö–∞–º–∏",
  "–ó–∞–ø–µ—á–µ–Ω–∏–π –±–∞—Ç–∞—Ç –∑ –π–æ–≥—É—Ä—Ç–æ–º","–ö—É—Å-–∫—É—Å –∑ –æ–≤–æ—á–∞–º–∏","–¢–æ—Å—Ç –∑ –ª–æ—Å–æ—Å–µ–º —ñ —Å–∏—Ä–æ–º","–°–∞–ª–∞—Ç —Ç–∞–±—É–ª–µ","–†–∞–≥—É –∑ –∫–≤–∞—Å–æ–ª—ñ",
  "–†–∏–±–Ω—ñ –∫–æ—Ç–ª–µ—Ç–∏ –Ω–∞ –ø–∞—Ä—É","–û–≤–æ—á–µ–≤–∏–π –∫–∞—Ä—ñ –∑ —Ä–∏—Å–æ–º","–°–∞–ª–∞—Ç –∫–∞–ø—Ä–µ–∑–µ –∑ —Ü—ñ–ª—å–Ω–æ–∑–µ—Ä–Ω–æ–≤–∏–º —Ö–ª—ñ–±–æ–º","–°–º—É–∑—ñ –±–æ—É–ª –∑ –≥—Ä–∞–Ω–æ–ª–æ—é","–°–∞–ª–∞—Ç –∑ –∫—ñ–Ω–æ–∞ —ñ –ø–æ–º—ñ–¥–æ—Ä—ñ–≤",
  "–õ–µ–≥–∫–∏–π –≥—Ä–µ—Ü—å–∫–∏–π —Å–∞–ª–∞—Ç","–ö—É—Ä–∫–∞ –∑ –ª–∏–º–æ–Ω–æ–º —ñ —Ç—Ä–∞–≤–∞–º–∏","–ë—É—Ä–≥–µ—Ä –∑ –ª–æ—Å–æ—Å–µ–º","–ë–æ—É–ª –∑ —Å–æ—á–µ–≤–∏—Ü–µ—é","–ü–µ—á–µ–Ω—ñ —è–±–ª—É–∫–∞ –∑ –π–æ–≥—É—Ä—Ç–æ–º"
]; // ~90+ entries

const QUOTES = [...Array(70)].map((_,i)=>`‚Äú–¶–∏—Ç–∞—Ç–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ—ó #${i+1} ‚Äî –ø—Ä–æ–¥–æ–≤–∂—É–π —ñ –Ω–µ –∑–¥–∞–≤–∞–π—Å—è.‚Äù`); // placeholder 70 quotes

/* ---------- Storage and State ---------- */
const STORAGE_KEY = 'lifebooster_full_v1';
let state = {
  users: [{id:randId(), name:'–ì—ñ—Å—Ç—å', coins:0, playlist:''}],
  currentUserId: null,
  tasks: [],
  dailyFoodsDate: null,
  dailyFoods: null,
  foxCoins: 0
};
loadState();

function randId(){ return Math.random().toString(36).slice(2,9); }
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
function loadState(){ const raw = localStorage.getItem(STORAGE_KEY); if(raw){ try{ state = JSON.parse(raw); } catch(e){ console.error(e); } } if(!state.currentUserId) state.currentUserId = state.users[0].id; saveState(); }

/* ---------- DOM ---------- */
const foodGrid = document.getElementById('foodGrid');
const addTaskBtn = document.getElementById('addTask');
const taskInput = document.getElementById('taskInput');
const tasksList = document.getElementById('tasksList');
const userBadge = document.getElementById('userBadge');
const profileName = document.getElementById('profileName');
const profileCoins = document.getElementById('profileCoins');
const foxBtn = document.getElementById('fox');
const quoteBox = document.getElementById('quoteBox');
const repCountEl = document.getElementById('repCount');
const foxCoinsEl = document.getElementById('foxCoins');
const addUserBtn = document.getElementById('addUserBtn');
const newUserName = document.getElementById('newUserName');
const usersList = document.getElementById('usersList');
const savePlaylist = document.getElementById('savePlaylist');
const playlistInput = document.getElementById('playlistInput');
const payFineBtn = document.getElementById('payFineBtn');
const toggleTheme = document.getElementById('toggleTheme');
const introModal = document.getElementById('introModal');
const startNowBtn = document.getElementById('startNow');
const closeIntro = document.getElementById('closeIntro');
const openIntro = document.getElementById('openIntro');

/* ---------- UI helpers ---------- */
function getCurrentUser(){ return state.users.find(u=>u.id===state.currentUserId) || state.users[0]; }
function renderProfile(){ const u = getCurrentUser(); userBadge.textContent = u.name; profileName.textContent = u.name; profileCoins.textContent = (u.coins||0)+' ü¶ä'; foxCoinsEl.textContent = (state.foxCoins||0); playlistInput.value = u.playlist||''; }
function notify(text){ console.log('NOTIFY:',text); /* simple toast using alert for prototype */ try{ /* non-blocking */ setTimeout(()=>{ /* no-op */ },10); }catch(e){} }

/* ---------- Foods (3 per day) ---------- */
function pickDailyFoods(){
  const today = new Date().toISOString().slice(0,10);
  if(state.dailyFoodsDate === today && state.dailyFoods) return state.dailyFoods;
  const pool = [...FOODS];
  const picks = [];
  for(let i=0;i<3;i++){ const idx=Math.floor(Math.random()*pool.length); picks.push(pool.splice(idx,1)[0]); }
  state.dailyFoods = picks; state.dailyFoodsDate = today; saveState(); return picks;
}
function renderFoods(){
  const picks = pickDailyFoods();
  foodGrid.innerHTML='';
  picks.forEach((f,i)=>{
    const card = document.createElement('div'); card.className='foodCard floaty';
    card.innerHTML = `<div style="display:flex;gap:10px;align-items:center"><div style="width:56px;height:56px;border-radius:10px;background:linear-gradient(135deg,#fff3,#fff2);display:flex;align-items:center;justify-content:center;color:#022;font-weight:800">${String.fromCodePoint(0x1F35E + i)}</div><div><div class="foodTitle">${f}</div><div class="foodSub">–Ü–¥–µ—è ${i+1} ‚Ä¢ 30‚Äë–¥–µ–Ω–Ω–∏–π –ø–ª–∞–Ω</div></div></div>`;
    card.onclick = ()=>{ const url = `https://www.google.com/search?q=${encodeURIComponent(f+' recipe')}`; window.open(url,'_blank'); };
    foodGrid.appendChild(card);
  });
}

/* ---------- Tasks ---------- */
function renderTasks(){
  tasksList.innerHTML='';
  const uid = state.currentUserId;
  const now = Date.now();
  const userTasks = state.tasks.filter(t=>t.userId===uid).sort((a,b)=>a.deadline-b.deadline);
  if(userTasks.length===0){ tasksList.innerHTML = '<div class="small">–ù–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å. –î–æ–¥–∞–π —Å–≤–æ—î –ø–µ—Ä—à–µ.</div>'; return; }
  userTasks.forEach(t=>{
    const el = document.createElement('div'); el.className='taskItem';
    const left = document.createElement('div'); left.style.flex='1';
    const remaining = Math.max(0, t.deadline - now);
    const hours = Math.floor(remaining/3600000); const mins = Math.floor((remaining%3600000)/60000);
    left.innerHTML = `<div style="font-weight:800">${t.text}</div><div class="taskMeta">–¢–µ—Ä–º—ñ–Ω: ${new Date(t.deadline).toLocaleString()} ‚Ä¢ –∑–∞–ª–∏—à–∏–ª–æ—Å—å: ${hours} –≥–æ–¥ ${mins} —Ö–≤</div>`;
    const right = document.createElement('div');
    const doneBtn = document.createElement('button'); doneBtn.className='btn'; doneBtn.textContent='–ó—Ä–æ–±–ª–µ–Ω–æ'; doneBtn.onclick = ()=>{ completeTask(t.id); };
    const delBtn = document.createElement('button'); delBtn.className='ghost'; delBtn.textContent='√ó'; delBtn.onclick = ()=>{ state.tasks = state.tasks.filter(x=>x.id!==t.id); saveState(); renderAll(); };
    right.appendChild(doneBtn); right.appendChild(delBtn);
    el.appendChild(left); el.appendChild(right);
    tasksList.appendChild(el);
    // check overdue
    if(!t.done && now>t.deadline && !t.penalized){
      t.penalized = true; t.difficultyMultiplier = (t.difficultyMultiplier||1)*1.015; const u = getCurrentUser(); u.coins = (u.coins||0) - 5; state.foxCoins = (state.foxCoins||0) - 5; saveState(); notify(`–ó–∞–≤–¥–∞–Ω–Ω—è "${t.text}" –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–æ ‚Äî —à—Ç—Ä–∞—Ñ 5 ü¶ä`);
    }
  });
}
addTaskBtn.onclick = ()=>{ const txt = taskInput.value.trim(); if(!txt) return; const id=randId(); state.tasks.push({id, userId: state.currentUserId, text: txt, created: Date.now(), deadline: Date.now()+24*3600*1000, done:false, difficultyMultiplier:1, penalized:false}); taskInput.value=''; saveState(); renderAll(); notify('–ó–∞–≤–¥–∞–Ω–Ω—è –¥–æ–¥–∞–Ω–æ'); }
function completeTask(id){
  const t = state.tasks.find(x=>x.id===id); if(!t) return; t.done = true; t.completedAt = Date.now(); const reward = Math.max(1, Math.round(2 * (t.difficultyMultiplier||1))); const u = getCurrentUser(); u.coins = (u.coins||0) + reward; state.foxCoins = (state.foxCoins||0) + reward; saveState(); renderAll(); showRandomQuote(); notify(`–í–∏–∫–æ–Ω–∞–Ω–æ. –û—Ç—Ä–∏–º–∞–Ω–æ ${reward} ü¶ä`); }

/* ---------- Users ---------- */
function renderUsers(){ usersList.innerHTML=''; state.users.forEach(u=>{ const el=document.createElement('div'); el.className='taskItem'; el.innerHTML = `<div style="flex:1">${u.name}<div class="taskMeta">Coins: ${u.coins||0} ü¶ä</div></div><div><button class="btn">–í–∏–±—Ä–∞—Ç–∏</button></div>`; usersList.appendChild(el); el.querySelector('button').onclick = ()=>{ state.currentUserId = u.id; saveState(); renderAll(); } }); }
addUserBtn.onclick = ()=>{ const name=newUserName.value.trim(); if(!name) return; state.users.push({id:randId(), name, coins:0, playlist:''}); newUserName.value=''; saveState(); renderAll(); notify('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –¥–æ–¥–∞–Ω–æ'); }

/* ---------- Playlist ---------- */
savePlaylist.onclick = ()=>{ const u=getCurrentUser(); u.playlist = playlistInput.value.trim(); saveState(); notify('–ü–ª–µ–π–ª–∏—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–æ'); }

/* ---------- Quotes ---------- */
function showRandomQuote(){ const q = QUOTES[Math.floor(Math.random()*QUOTES.length)]; quoteBox.textContent = q; }
showRandomQuote();

/* ---------- Fox button ---------- */
foxBtn.onclick = ()=>{ const u=getCurrentUser(); window.open(u.playlist || 'https://t.me/your_help_link','_blank'); }

/* ---------- Pay fine ---------- */
payFineBtn.onclick = ()=>{ const u=getCurrentUser(); if((u.coins||0) >= 5){ u.coins -= 5; saveState(); renderAll(); notify('–®—Ç—Ä–∞—Ñ —Å–ø–ª–∞—á–µ–Ω–æ'); } else notify('–ù–µ –≤–∏—Å—Ç–∞—á–∞—î –ª–∏—Å–∏–Ω—è—Ç'); }

/* ---------- Theme / Background logic ---------- */
let night = true;
const dayLayer = document.getElementById('dayLayer');
const nightLayer = document.getElementById('nightLayer');
const slideshow = document.getElementById('slideshow');
const starCanvas = document.getElementById('starCanvas');
const earthWrap = document.getElementById('earthWrap');
const scenic = [
  'https://images.unsplash.com/photo-1501785888041-af3ef285b470?auto=format&fit=crop&w=1600&q=60',
  'https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=1600&q=60',
  'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1600&q=60',
  'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?auto=format&fit=crop&w=1600&q=60'
];
// create slides
scenic.forEach((src,i)=>{ const s = document.createElement('div'); s.className='slide'; s.style.backgroundImage = `url(${src})`; if(i===0) s.classList.add('show'); slideshow.appendChild(s); });
let slideIndex = 0;
setInterval(()=>{ const slides = document.querySelectorAll('.slide'); slides.forEach((s,idx)=>s.classList.remove('show')); slideIndex = (slideIndex+1)%slides.length; slides[slideIndex].classList.add('show'); }, 8000);

function setTheme(isNight){
  night = isNight;
  if(night){ dayLayer.style.opacity = 0; nightLayer.style.opacity = 1; toggleTheme.textContent = '–î–µ–Ω–Ω–∏–π —Ä–µ–∂–∏–º'; } else { dayLayer.style.opacity = 1; nightLayer.style.opacity = 0; toggleTheme.textContent = '–ù—ñ—á–Ω–∏–π —Ä–µ–∂–∏–º'; }
}
toggleTheme.onclick = ()=>{ setTheme(!night); }
setTheme(true); // start night

/* ---------- Stars and Earth (canvas) ---------- */
function setupStars(){
  starCanvas.width = window.innerWidth; starCanvas.height = window.innerHeight;
  const ctx = starCanvas.getContext('2d');
  const stars = [];
  for(let i=0;i<240;i++){ stars.push({x:Math.random()*starCanvas.width, y:Math.random()*starCanvas.height, r:Math.random()*1.6, a:Math.random()*1, s:Math.random()*0.02+0.004}); }
  function draw(){ ctx.clearRect(0,0,starCanvas.width,starCanvas.height); stars.forEach(s=>{ s.a += s.s; if(s.a>1) s.a=0; ctx.beginPath(); ctx.fillStyle = `rgba(255,255,255,${0.3 + 0.7*s.a})`; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); }); requestAnimationFrame(draw); }
  draw();
}
setupStars();
window.addEventListener('resize', ()=>{ setupStars(); });

// create rotating earth
const earth = document.createElement('div'); earth.style.width='100%'; earth.style.height='100%'; earth.style.borderRadius='50%'; earth.style.overflow='hidden'; earth.style.transformOrigin='center center'; earth.style.animation='rotateSlow 80s linear infinite';
const earthImg = document.createElement('img'); earthImg.src = 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/07/Blue_Marble.jpg/800px-Blue_Marble.jpg'; earthImg.style.width='160%'; earthImg.style.position='relative'; earthImg.style.left='-30%'; earthImg.style.top='-10%'; earth.appendChild(earthImg); earthWrap.appendChild(earth); earthWrap.style.opacity = 0.95;

/* ---------- Exercise / MoveNet ---------- */
let detector = null;
async function ensureDetector(){ if(detector) return detector; detector = await poseDetection.createDetector(poseDetection.SupportedModels.MoveNet, {modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING}); return detector; }
const video = document.createElement('video'); video.width=320; video.height=240; video.style.display='none'; document.body.appendChild(video);
let stream=null;
async function startCam(){ if(stream) return; try{ stream = await navigator.mediaDevices.getUserMedia({video:{width:320,height:240, facingMode:'user'}, audio:false}); video.srcObject = stream; await video.play(); await ensureDetector(); }catch(e){ alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏: ' + e.message); } }
const exerciseCanvas = document.getElementById('exerciseCanvas'); const exCtx = exerciseCanvas.getContext('2d');
let exState = {type:null, baseline:null, down:false, reps:0, walkSteps:0, lastMag:0};

document.getElementById('choosePush').onclick = ()=>{ prepareExercise('push'); }
document.getElementById('chooseSquat').onclick = ()=>{ prepareExercise('squat'); }
document.getElementById('chooseWalk').onclick = ()=>{ prepareExercise('walk'); }

async function prepareExercise(type){
  exState.type = type; exState.reps = 0; exState.down=false; exState.baseline=null; repCountEl.textContent = '0';
  if(type === 'walk'){
    if(window.DeviceMotionEvent && typeof DeviceMotionEvent.requestPermission === 'function'){
      DeviceMotionEvent.requestPermission().then(res=>{ if(res==='granted'){ startWalking(); } else alert('–î–æ–∑–≤—ñ–ª –¥–∞—Ç—á–∏–∫—ñ–≤ –Ω–µ –Ω–∞–¥–∞–Ω–æ'); }).catch(()=>{ alert('–ü–æ–º–∏–ª–∫–∞ –∑–∞–ø–∏—Ç—É –¥–æ–∑–≤–æ–ª—É –¥–∞—Ç—á–∏–∫—ñ–≤'); });
    } else if(window.DeviceMotionEvent){
      startWalking();
    } else {
      alert('–î–∞—Ç—á–∏–∫–∏ —Ä—É—Ö—É –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ñ ‚Äî —Å–∏–º—É–ª—é–π—Ç–µ –∫—Ä–æ–∫–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—è–º "m" –Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—ñ');
    }
    return;
  }
  await startCam();
  runExerciseLoop();
}

function startWalking(){ window.addEventListener('devicemotion', handleMotion); alert('–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ö–æ–¥—å–±–∏ –∑–∞–ø—É—â–µ–Ω–æ ‚Äî —Ä—É—Ö–∞–π—Å—è, —â–æ–± –∑–±–∏—Ä–∞—Ç–∏ –ª–∏—Å–∏–Ω—è—Ç–∞'); }
function handleMotion(e){ const acc = e.accelerationIncludingGravity || e.acceleration; if(!acc) return; const mag = Math.sqrt((acc.x||0)**2 + (acc.y||0)**2 + (acc.z||0)**2); if(!exState.lastMag) exState.lastMag = mag; if(mag - exState.lastMag > 1.2){ exState.walkSteps++; repCountEl.textContent = exState.walkSteps; if(exState.walkSteps % 30 === 0){ const u = getCurrentUser(); u.coins = (u.coins||0)+1; state.foxCoins = (state.foxCoins||0)+1; saveState(); renderProfile(); notify('–û—Ç—Ä–∏–º–∞–Ω–æ 1 ü¶ä –∑–∞ —Ö–æ–¥—å–±—É'); } } exState.lastMag = mag; }

async function runExerciseLoop(){
  if(!detector) await ensureDetector();
  const poses = await detector.estimatePoses(video); exCtx.clearRect(0,0,exerciseCanvas.width,exerciseCanvas.height); exCtx.drawImage(video,0,0,exerciseCanvas.width,exerciseCanvas.height);
  if(poses && poses.length>0){ const p = poses[0]; drawKeypoints(p.keypoints); if(exState.type==='push') handlePush(p); if(exState.type==='squat') handleSquat(p); }
  requestAnimationFrame(runExerciseLoop);
}

function drawKeypoints(kps){ exCtx.fillStyle='rgba(122,200,255,0.9)'; kps.forEach(k=>{ if(k.score>0.4){ exCtx.beginPath(); exCtx.arc(k.x, k.y, 4,0,Math.PI*2); exCtx.fill(); } }); }

function avgTorsoY(p){ const left_sh = p.keypoints.find(k=>k.name==='left_shoulder'); const right_sh = p.keypoints.find(k=>k.name==='right_shoulder'); const left_hip = p.keypoints.find(k=>k.name==='left_hip'); const right_hip = p.keypoints.find(k=>k.name==='right_hip'); const arr = []; [left_sh,right_sh,left_hip,right_hip].forEach(x=>{ if(x && x.score>0.3) arr.push(x.y); }); if(arr.length===0) return null; return arr.reduce((a,b)=>a+b,0)/arr.length; }

function handlePush(p){
  const y = avgTorsoY(p); if(y===null) return; if(exState.baseline===null) exState.baseline = y; const delta = y - exState.baseline; const DOWN=26, UP=14; if(!exState.down && delta > DOWN){ exState.down = true; } if(exState.down && delta < UP){ exState.down = false; exState.reps++; repCountEl.textContent = exState.reps; awardForRep(); } }

function handleSquat(p){
  const left_hip = p.keypoints.find(k=>k.name==='left_hip'); const right_hip = p.keypoints.find(k=>k.name==='right_hip'); const hipY = ((left_hip?.y||0)+(right_hip?.y||0))/2; if(exState.baseline===null) exState.baseline = hipY; const delta = exState.baseline - hipY; const DOWN=18, UP=10; if(!exState.down && delta > DOWN){ exState.down=true; } if(exState.down && delta < UP){ exState.down=false; exState.reps++; repCountEl.textContent = exState.reps; awardForRep(); } }

function awardForRep(){ // small reward
  if(exState.reps % 10 === 0){ const u = getCurrentUser(); u.coins = (u.coins||0) + 1; state.foxCoins = (state.foxCoins||0) + 1; saveState(); renderProfile(); notify('–û—Ç—Ä–∏–º–∞–Ω–æ 1 ü¶ä –∑–∞ –≤–ø—Ä–∞–≤–∏!'); } saveState(); }

/* ---------- Init / Render ---------- */
function renderAll(){ renderFoods(); renderTasks(); renderUsers(); renderProfile(); repCountEl.textContent = '0'; }
renderAll();

/* ---------- UI interactions ---------- */
document.getElementById('openLogin').onclick = ()=>{ const name = prompt('–í–≤–µ–¥–∏ —ñ–º\'—è (–ª–æ–∫–∞–ª—å–Ω–æ):', getCurrentUser().name || '–ì—ñ—Å—Ç—å'); if(name){ getCurrentUser().name = name; saveState(); renderAll(); notify('–Ü–º\'—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ'); } }
document.getElementById('addUserBtn').onclick = ()=>{ const name = newUserName.value.trim(); if(!name) return; state.users.push({id:randId(), name, coins:0, playlist:''}); newUserName.value=''; saveState(); renderAll(); }
document.getElementById('payFineBtn').onclick = ()=>{ const u = getCurrentUser(); if((u.coins||0) >= 5){ u.coins -=5; saveState(); renderAll(); notify('–®—Ç—Ä–∞—Ñ —Å–ø–ª–∞—á–µ–Ω–æ'); } else alert('–ù–µ –≤–∏—Å—Ç–∞—á–∞—î –ª–∏—Å–∏–Ω—è—Ç'); }
document.getElementById('startNow').onclick = ()=>{ introModal.style.display='none'; }
document.getElementById('closeIntro').onclick = ()=>{ introModal.style.display='none'; }
document.getElementById('openIntro').onclick = ()=>{ introModal.style.display='flex'; }

/* ---------- finalize ---------- */
window.addEventListener('beforeunload', ()=>{ saveState(); });

</script>
</body>
</html>
